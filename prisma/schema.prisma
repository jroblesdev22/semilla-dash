generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["driverAdapters"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id
  name          String?
  email         String?  @unique
  emailVerified DateTime?
  // Numero de WhatsApp del usuario
  whatsapp_phone String?
  // ID del usuario en Google Classroom
  classroomUserId String? @unique
  // Rol del usuario: student o teacher
  role          String   @default("student")

  // Relations
  cell_members CellMember[]

  @@index([email])
  @@index([classroomUserId])
  @@index([role])
}

model Course {
  id          String    @id
  // Nombre del curso
  name        String
  // Descripción del curso
  description String?
  // Color en formato hexadecimal
  color_hex   String
  // ID del curso en Google Classroom
  classroomId String?   @unique
  // Email del propietario del curso
  ownerId     String
  // Fechas de creación y actualización
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  cells    Cell[]

  @@index([classroomId])
  @@index([ownerId])
}

model Cell {
  id         String   @id
  // Nombre de la celula
  name       String
  course_id  String
  created_at DateTime?
  updated_at DateTime?
  
  // Relations
  course       Course       @relation(fields: [course_id], references: [id])
  cell_members CellMember[]

  @@index([course_id])
}

model CellMember {
  id        String   @id
  cell_id   String
  user_id   String
  joined_at DateTime?

  // Relations
  cell Cell @relation(fields: [cell_id], references: [id])
  user User @relation(fields: [user_id], references: [id])

  @@unique([cell_id, user_id])
  @@index([cell_id])
  @@index([user_id])
}
